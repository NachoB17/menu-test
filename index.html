<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu ‚Äî Maison Fleurie</title>
  <meta name="description" content="D√©couvrez le menu de Maison Fleurie ‚Äî Table des Mets, Cocktails & Vins √† Montpellier." />
  <meta name="theme-color" content="#0D1F13" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="fr_FR" />
  <meta property="og:title" content="Menu ‚Äî Maison Fleurie" />
  <meta property="og:description" content="Table des Mets ‚Ä¢ Cocktails ‚Ä¢ Vins √† Montpellier" />
  <meta property="og:image" content="https://raw.githubusercontent.com/maison-fleurie/Menu/main/logo.png" />
  <meta property="og:url" content="" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Fonts & perf -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- PapaParse (SRI + defer) -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      /* Palette Premium - Tons Naturels et Raffin√©s */
      --deep-sage: #1A2E25;
      --sage-medium: #3D5A4C;
      --cream: #FAF8F4;
      --warm-white: #FFFFFF;
      --soft-gold: #C5B78F;
      --bronze: #9B8B6C;
      --charcoal: #2C2C2C;
      --text-primary: #1A2E25;
      --text-secondary: #5A6B62;
      --text-muted: #8A9B92;

      /* Shadows Premium */
      --shadow-sm: 0 1px 3px rgba(26, 46, 37, 0.04), 0 1px 2px rgba(26, 46, 37, 0.02);
      --shadow-md: 0 4px 12px rgba(26, 46, 37, 0.06), 0 2px 4px rgba(26, 46, 37, 0.03);
      --shadow-lg: 0 12px 24px rgba(26, 46, 37, 0.08), 0 4px 8px rgba(26, 46, 37, 0.04);
      --shadow-xl: 0 20px 40px rgba(26, 46, 37, 0.1), 0 8px 16px rgba(26, 46, 37, 0.06);

      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;

      /* Spacing */
      --space-xs: 0.5rem;
      --space-sm: 0.75rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
    }

    *{
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html{
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    html:focus-within{
      scroll-behavior: smooth;
    }

    body{
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, var(--cream) 0%, #F5F3EE 100%);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.65;
      letter-spacing: -0.011em;
    }

    a, button{
      outline-offset: 3px;
    }

    /* Header Premium */
    header.header{
      position: relative;
      text-align: center;
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      padding: var(--space-2xl) var(--space-lg) var(--space-xl);
      box-shadow: var(--shadow-lg);
      border-bottom: 1px solid rgba(197, 183, 143, 0.15);
    }

    .header-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-lg);
      margin: 0;
      font-size: 2.75rem;
      font-weight: 400;
      letter-spacing: 0.15em;
      line-height: 1.2;
      text-transform: uppercase;
    }

    .header-logo{
      height: 2.6rem;
      width: 2.6rem;
      object-fit: contain;
      filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.15));
      transition: transform 0.3s ease;
    }

    .header-logo:hover{
      transform: scale(1.05);
    }

    .header-subtitle{
      margin: var(--space-md) 0 0;
      font-size: 1.125rem;
      font-weight: 300;
      letter-spacing: 0.08em;
      color: var(--soft-gold);
      font-family: 'Inter', sans-serif;
    }

    /* Share Button */
    .share-btn{
      position: absolute;
      right: var(--space-lg);
      top: var(--space-lg);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 1px solid rgba(197, 183, 143, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: var(--soft-gold);
      cursor: pointer;
      backdrop-filter: blur(8px);
      transition: all 0.2s ease;
    }

    .share-btn:hover{
      background: rgba(255, 255, 255, 0.18);
      border-color: rgba(197, 183, 143, 0.5);
      transform: translateY(-1px);
    }

    /* Search Container */
    .search-container{
      margin: var(--space-xl) auto var(--space-lg);
      max-width: 680px;
      padding: 0 var(--space-lg);
    }

    .search-row{
      display: flex;
      gap: var(--space-sm);
    }

    .search-box{
      flex: 1;
      padding: var(--space-md) var(--space-lg);
      font-size: 1rem;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(26, 46, 37, 0.12);
      background: var(--warm-white);
      box-shadow: var(--shadow-sm);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    .search-box::placeholder{
      color: var(--text-muted);
    }

    .search-box:focus{
      border-color: var(--sage-medium);
      box-shadow: var(--shadow-md), 0 0 0 3px rgba(61, 90, 76, 0.08);
      background: var(--warm-white);
      outline: none;
    }

    .clear-btn{
      border: 1px solid rgba(26, 46, 37, 0.12);
      background: var(--warm-white);
      border-radius: var(--radius-lg);
      padding: var(--space-md) var(--space-lg);
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
      opacity: 0;
      pointer-events: none;
    }

    .clear-btn.visible{
      opacity: 1;
      pointer-events: auto;
    }

    .clear-btn:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
    }

    .search-results-info{
      font-size: 0.9375rem;
      color: var(--text-secondary);
      margin: var(--space-md) 0;
      font-weight: 500;
      text-align: center;
      padding: var(--space-sm) var(--space-lg);
      background: var(--warm-white);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      border: 1px solid rgba(26, 46, 37, 0.08);
    }

    /* Main Container */
    main.container{
      max-width: 880px;
      margin: var(--space-lg) auto var(--space-2xl);
      background: var(--warm-white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      border: 1px solid rgba(26, 46, 37, 0.08);
    }

    /* Tab Navigation */
    .tab-btn{
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .tab-btn .ico{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
    }

    .tab-btn .ico svg{
      width: 18px;
      height: 18px;
      display: block;
    }

    nav.tab-nav{
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: linear-gradient(180deg, var(--cream) 0%, var(--warm-white) 100%);
      border-bottom: 1px solid rgba(26, 46, 37, 0.1);
      gap: var(--space-xs);
      padding: var(--space-lg);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(12px);
    }

    .tab-btn{
      background: var(--warm-white);
      border: 1px solid rgba(26, 46, 37, 0.15);
      padding: var(--space-sm) var(--space-md);
      font-size: 0.9375rem;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-primary);
      border-radius: var(--radius-md);
      position: relative;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
    }

    .tab-btn:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .tab-btn[aria-selected="true"]{
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      border-color: var(--bronze);
      box-shadow: var(--shadow-md);
    }

    /* Tab Content */
    .tab-content{
      display: none;
      padding: var(--space-xl) var(--space-lg);
      background: var(--warm-white);
      min-height: 420px;
    }

    .tab-content.active{
      display: block;
    }

    /* Menu Items - Premium Design */
    .menu-item{
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-lg);
      padding: var(--space-lg) var(--space-md);
      border-bottom: 1px solid rgba(26, 46, 37, 0.06);
      background: linear-gradient(180deg, rgba(250, 248, 244, 0.3) 0%, rgba(255, 255, 255, 0.5) 100%);
      border-radius: var(--radius-md);
      transition: all 0.2s ease;
    }

    .menu-item:hover{
      background: rgba(250, 248, 244, 0.6);
      box-shadow: var(--shadow-sm);
      transform: translateX(2px);
    }

    .menu-item + .menu-item{
      margin-top: var(--space-sm);
    }

    .item-info{
      flex: 1;
      min-width: 0;
    }

    .item-name{
      font-size: 1.375rem;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.01em;
      line-height: 1.4;
      font-family: 'Cormorant Garamond', Georgia, serif;
    }

    .item-section{
      font-size: 0.75rem;
      color: var(--text-muted);
      margin: var(--space-xs) 0 var(--space-sm);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }

    .item-description{
      font-size: 0.9375rem;
      color: var(--text-secondary);
      font-style: italic;
      margin-top: var(--space-xs);
      line-height: 1.5;
      font-weight: 400;
    }

    .item-price{
      font-size: 1.0625rem;
      color: var(--text-primary);
      font-weight: 600;
      background: linear-gradient(135deg, rgba(197, 183, 143, 0.15) 0%, rgba(197, 183, 143, 0.08) 100%);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md);
      min-width: 80px;
      text-align: center;
      border: 1px solid rgba(197, 183, 143, 0.2);
      white-space: nowrap;
    }

    /* Section Titles */
    .section-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: var(--space-xl) 0 var(--space-lg);
      text-align: center;
      letter-spacing: 0.02em;
      position: relative;
    }

    .section-title::after{
      content: '';
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--soft-gold), transparent);
      border-radius: 2px;
    }

    .now-title{
      font-size: 1.5rem;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-weight: 500;
      color: var(--sage-medium);
      margin: var(--space-lg) 0;
      text-align: center;
      letter-spacing: 0.02em;
    }

    /* Empty State */
    .empty-state{
      text-align: center;
      color: var(--text-secondary);
      margin: var(--space-xl) 0;
      padding: var(--space-xl) var(--space-lg);
      background: linear-gradient(180deg, rgba(250, 248, 244, 0.4) 0%, rgba(255, 255, 255, 0.6) 100%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(26, 46, 37, 0.08);
    }

    .empty-state h3{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }

    /* Skeleton Loader */
    .skeleton{
      display: block;
      height: 16px;
      background: linear-gradient(90deg, #f0f0f0, #f8f8f8, #f0f0f0);
      background-size: 200px 100%;
      border-radius: var(--radius-sm);
      animation: sheen 1.8s ease-in-out infinite;
    }

    .skeleton.big{
      height: 22px;
    }

    @keyframes sheen{
      0%{
        background-position: -200px 0;
      }
      100%{
        background-position: calc(200px + 100%) 0;
      }
    }

    /* Wine Decision Tree */
    .wine-tree{
      padding: var(--space-xl) var(--space-lg);
    }

    .wine-tree-header{
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
      justify-content: center;
    }

    .wine-tree-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
      letter-spacing: 0.01em;
    }

    .wine-icon{
      width: 28px;
      height: 28px;
      color: var(--soft-gold);
    }

    .progress-bar{
      display: flex;
      gap: var(--space-xs);
      margin-bottom: var(--space-md);
    }

    .progress-step{
      flex: 1;
      height: 6px;
      background: rgba(197, 183, 143, 0.2);
      border-radius: var(--radius-sm);
      transition: all 0.3s ease;
    }

    .progress-step.active{
      background: linear-gradient(90deg, var(--soft-gold), var(--bronze));
    }

    .progress-info{
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: var(--space-md);
      font-weight: 500;
    }

    .question-title{
      font-size: 1.5rem;
      font-weight: 500;
      font-family: 'Cormorant Garamond', Georgia, serif;
      color: var(--text-primary);
      margin-bottom: var(--space-lg);
      text-align: center;
      letter-spacing: 0.01em;
    }
    
    .wine-options{
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .wine-option{
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      text-align: left;
      border: 1px solid rgba(26, 46, 37, 0.15);
      border-radius: var(--radius-lg);
      background: var(--warm-white);
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-family: 'Inter', sans-serif;
      box-shadow: var(--shadow-sm);
    }

    .wine-option:hover{
      border-color: var(--sage-medium);
      background: var(--cream);
      transform: translateX(3px);
      box-shadow: var(--shadow-md);
    }

    .wine-option-content{
      flex: 1;
    }

    .wine-option-label{
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .wine-option-desc{
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-top: var(--space-xs);
      font-style: italic;
      font-weight: 400;
      line-height: 1.5;
    }

    .wine-option-icon{
      font-size: 1.375rem;
    }

    .chevron-icon{
      width: 18px;
      height: 18px;
      color: var(--soft-gold);
      transition: transform 0.2s ease;
    }

    .wine-option:hover .chevron-icon{
      transform: translateX(4px);
    }

    .wine-nav-btns{
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-xl);
      justify-content: center;
      flex-wrap: wrap;
    }

    .wine-btn{
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-lg);
      font-size: 0.9375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(26, 46, 37, 0.15);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-family: 'Inter', sans-serif;
    }

    .wine-btn-back{
      background: var(--warm-white);
      border: 1px solid rgba(26, 46, 37, 0.15);
      color: var(--text-primary);
    }

    .wine-btn-back:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .wine-btn-primary{
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      border: 1px solid var(--bronze);
    }

    .wine-btn-primary:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .wine-btn-secondary{
      background: var(--warm-white);
      border: 1px solid rgba(26, 46, 37, 0.2);
      color: var(--text-primary);
    }

    .wine-btn-secondary:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }
    
    /* Wine Recommendations */
    .wine-recommendations{
      padding: var(--space-xl) var(--space-lg);
    }

    .reco-header{
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
      justify-content: center;
    }

    .reco-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
      letter-spacing: 0.01em;
    }

    .wine-card{
      border: 1px solid rgba(26, 46, 37, 0.12);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin-bottom: var(--space-sm);
      background: linear-gradient(180deg, rgba(250, 248, 244, 0.4) 0%, rgba(255, 255, 255, 0.8) 100%);
      transition: all 0.25s ease;
      box-shadow: var(--shadow-sm);
    }

    .wine-card:hover{
      border-color: var(--sage-medium);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
      background: rgba(250, 248, 244, 0.6);
    }

    .wine-card-header{
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: var(--space-sm);
      gap: var(--space-lg);
    }

    .wine-card-name{
      font-size: 1.125rem;
      font-weight: 500;
      font-family: 'Cormorant Garamond', Georgia, serif;
      color: var(--text-primary);
      flex: 1;
      line-height: 1.4;
      letter-spacing: -0.01em;
    }

    .wine-card-price{
      font-size: 1.0625rem;
      font-weight: 600;
      color: var(--text-primary);
      background: var(--warm-white);
      border: 1px solid rgba(197, 183, 143, 0.3);
      padding: var(--space-xs) var(--space-md);
      border-radius: var(--radius-md);
      white-space: nowrap;
    }

    .wine-card-region{
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: var(--space-xs);
    }

    .wine-card-grapes{
      color: var(--text-muted);
      font-size: 0.8125rem;
      margin-bottom: var(--space-sm);
      font-weight: 400;
      font-style: italic;
      line-height: 1.5;
    }

    /* Responsive Design */
    @media (max-width: 768px){
      .header-title{
        font-size: 2rem;
        gap: var(--space-md);
        letter-spacing: 0.1em;
      }

      .header-logo{
        height: 2.2rem;
        width: 2.2rem;
      }

      .header-subtitle{
        font-size: 1rem;
      }

      .share-btn{
        right: var(--space-md);
        top: var(--space-md);
        width: 40px;
        height: 40px;
      }

      .search-container{
        padding: 0 var(--space-md);
      }

      .menu-item{
        flex-direction: row;
        align-items: flex-start;
        gap: var(--space-md);
      }

      .item-price{
        flex-shrink: 0;
        margin-top: 0;
      }

      .wine-card-header{
        flex-direction: column;
        gap: var(--space-sm);
      }

      .wine-card-price{
        align-self: flex-start;
      }

      .wine-nav-btns{
        flex-direction: column;
      }

      .wine-btn{
        width: 100%;
        justify-content: center;
      }

      .tab-nav{
        padding: var(--space-md);
        gap: var(--space-xs);
      }

      .tab-btn{
        font-size: 0.875rem;
        padding: var(--space-xs) var(--space-sm);
      }

      .section-title{
        font-size: 1.625rem;
      }

      .wine-tree-title, .reco-title{
        font-size: 1.5rem;
      }

      .question-title{
        font-size: 1.25rem;
      }
    }

    @media (max-width: 480px){
      .header-title{
        font-size: 1.75rem;
        flex-direction: column;
        gap: var(--space-sm);
      }

      .header-logo{
        height: 2rem;
        width: 2rem;
      }

      main.container{
        border-radius: var(--radius-md);
        margin: var(--space-md) var(--space-xs) var(--space-xl);
      }

      .search-row{
        flex-direction: column;
      }

      .clear-btn{
        width: 100%;
      }
    }

    /* Splash Screen Premium */
    #splashScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    #splashScreen.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .splash-logo {
      width: 320px;
      max-width: 85vw;
      height: auto;
      object-fit: contain;
      filter: drop-shadow(0 8px 32px rgba(0, 0, 0, 0.3));
      animation: splashPulse 2s ease-in-out infinite;
    }

    .splash-loader {
      width: 40px;
      height: 40px;
      margin-top: var(--space-2xl);
      border: 3px solid rgba(197, 183, 143, 0.3);
      border-top-color: var(--soft-gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes splashPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.95;
      }
      50% {
        transform: scale(1.02);
        opacity: 1;
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @media (max-width: 768px) {
      .splash-logo {
        width: 280px;
      }
    }

    @media (max-width: 480px) {
      .splash-logo {
        width: 240px;
      }
    }

    /* Footer */
    footer.footer{
      text-align: center;
      padding: var(--space-lg);
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      background: var(--warm-white);
      border-top: 1px solid rgba(26, 46, 37, 0.08);
      margin-top: var(--space-xl);
    }
  </style>
</head>
<body>
  <!-- Splash Screen Premium -->
  <div id="splashScreen">
    <img src="./logo_chargement.png" alt="Maison Fleurie" class="splash-logo" />
    <div class="splash-loader"></div>
  </div>

  <header class="header" role="banner">
    <h1 class="header-title"><span>MAISON</span>
      <img src="https://raw.githubusercontent.com/maison-fleurie/Menu/main/logo.png" alt="Logo Maison Fleurie" class="header-logo" />
      <span>FLEURIE</span></h1>
    
    <button id="btnShare" class="share-btn" aria-label="Partager" title="Partager" tabindex="0">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.02-4.11A2.99 2.99 0 0 0 18 7.91c1.66 0 3-1.34 3-3S19.66 2 18 2s-3 1.34-3 3c0 .24.04.47.09.7l-7.02 4.11A2.99 2.99 0 0 0 6 9.91c-1.66 0-3 1.34-3 3s1.34 3 3 3c.82 0 1.56-.33 2.09-.87l7.02 4.11c-.05.21-.08.43-.08.66 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3Z"/></svg>
    </button>
    <p class="header-subtitle">Table des Mets ‚Ä¢ Cocktails ‚Ä¢ Vins</p>
  </header>

  <noscript>
    <style>.nojs{max-width:900px;margin:1rem auto;background:#fff;border:1px solid #c00;color:#111;padding:1rem;border-radius:12px}</style>
    <div class="nojs">‚ö†Ô∏è JavaScript est d√©sactiv√©. Activez‚Äële pour voir le menu interactif.</div>
  </noscript>

  <div class="search-container">
    <div class="search-row">
      <input id="searchBox" class="search-box" type="search" placeholder="Rechercher‚Ä¶ (ex: Vin, Bi√®re, Karaage poulet)" autocomplete="off" />
      <button id="clearSearch" class="clear-btn" aria-label="Effacer">‚úñ</button>
    </div>
    <div id="searchInfo" class="search-results-info" style="display:none"></div>
  </div>

  <main id="main" class="container" role="main">
    <nav class="tab-nav" role="tablist">
      <button id="tab-now" class="tab-btn" role="tab" aria-selected="true" data-tab="now"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l2 5 5 2-5 2-2 5-2-5-5-2 5-2z"/></svg></span><span>En ce moment</span></button>
      <button id="tab-deguster" class="tab-btn" role="tab" aria-selected="false" data-tab="deguster"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 3v10M11 3v10M5 7h8M16 4h3v9a3 3 0 0 1-3 3h-3"/></svg></span><span>D√©guster</span></button>
      <button id="tab-cocktails" class="tab-btn" role="tab" aria-selected="false" data-tab="cocktails"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M3 4h18l-7 7v7h-4v-7z"/></svg></span><span>Cocktails</span></button>
      <button id="tab-chaudes" class="tab-btn" role="tab" aria-selected="false" data-tab="chaudes"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M4 8h12a4 4 0 0 1 0 8H4z"/><path d="M7 4c0 2 2 2 2 4s-2 2-2 4"/></svg></span><span>Chaudes</span></button>
      <button id="tab-bieres" class="tab-btn" role="tab" aria-selected="false" data-tab="bieres"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 8h8v12H7z"/><path d="M15 10h2a3 3 0 0 1 0 6h-2"/></svg></span><span>Bi√®res</span></button>
      <button id="tab-softs" class="tab-btn" role="tab" aria-selected="false" data-tab="softs"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 7h10l-2 13H9z"/><path d="M9 11h8"/></svg></span><span>Softs</span></button>
      <button id="tab-vins" class="tab-btn" role="tab" aria-selected="false" data-tab="vins"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 3h10l-1 6a6 6 0 1 1-8 0z"/><path d="M12 15v6"/></svg></span><span>Vins</span></button>
    </nav>

    <section id="panel-now" class="tab-content active"></section>
    <section id="panel-deguster" class="tab-content"></section>
    <section id="panel-cocktails" class="tab-content"></section>
    <section id="panel-chaudes" class="tab-content"></section>
    <section id="panel-bieres" class="tab-content"></section>
    <section id="panel-softs" class="tab-content"></section>
    <section id="panel-vins" class="tab-content"></section>

    <div id="errorContainer" class="empty-state" style="display:none">
      <h3>Oups ! Impossible de charger le menu</h3>
      <p>V√©rifiez votre connexion et r√©essayez.</p>
      <button id="retryBtn">üîÑ R√©essayer</button>
    </div>
  </main>

  <footer class="footer">
    Prix net TTC & service compris
  </footer>

  <script>
    if (typeof window !== 'undefined' && typeof window.invoke === 'undefined') {
      window.invoke = function(){ console.warn('[shim] window.invoke() non d√©fini'); };
    }

    const CSV_URL = 'https://docs.google.com/spreadsheets/d/1lgd-rGS2kLCn0yPtGMc7RyMDue-YERmKOjNT3QKgJ3Y/export?format=csv&gid=0';
    const CACHE_KEY = 'mf-menu-v1'; const CACHE_AT = 'mf-menu-at'; const CACHE_TTL = 15*60*1000;

    let allMenuData = [], wineData = [], currentTab = 'now', isSearching = false, searchTimeout;
    let wineTreeStep = 0, wineTreeSelections = {}, showingWineList = false;
    let lastQuery = '', lastSearchResults = [], placeholderInterval;

    const normalize = (s='') => s.toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();
    const tabIdFromOnglet = (s='') => normalize(s).replace(/\s/g,'');
    const formatPrice = (raw='') => {
      const str = String(raw).trim();
      if (!str || /‚Ç¨|\//.test(str)) return str;
      const num = Number(str.replace(',','.'));
      return (!isNaN(num) && Number.isInteger(num)) ? `${num}‚Ç¨` : str;
    };
    const byNameFR = (a,b) => (a?.Nom||'').localeCompare(b?.Nom||'','fr',{sensitivity:'base'});
    const qs = sel => document.querySelector(sel);
    const qsa = sel => Array.from(document.querySelectorAll(sel));

    // SYST√àME DYNAMIQUE - 4 QUESTIONS MAX
    // Les questions utilisent les tags de la base de donn√©es (tag_couleur, tag_moment, tag_style, tag_accord)

    const wineQuestions = [
      // Q1: Couleur (obligatoire)
      {
        id: 'color',
        question: 'Quelle couleur ?',
        tag: 'tag_couleur',
        options: [
          { value: 'blanc', label: 'Blanc', icon: 'ü§ç' },
          { value: 'rouge', label: 'Rouge', icon: '‚ù§Ô∏è' },
          { value: 'rose', label: 'Ros√©', icon: 'üå∏' }
        ]
      },
      // Q2: Moment (obligatoire)
      {
        id: 'moment',
        question: 'C\'est pour quel moment ?',
        tag: 'tag_moment',
        options: [
          { value: 'apero', label: '√Ä l\'ap√©ritif', desc: 'Verres 12cl, l√©gers et frais' },
          { value: 'plat', label: 'Avec un plat', desc: 'Bouteilles pour accompagner' },
          { value: 'degustation', label: 'Pour d√©couvrir', desc: 'Vins nature, bio, terroir' }
        ]
      },
      // Q3: Style (d√©pend de la couleur)
      {
        id: 'style',
        question: (sel) => {
          if (sel.color === 'blanc') return 'Quel style en blanc ?';
          if (sel.color === 'rouge') return 'Quel style en rouge ?';
          return 'Quel style ?';
        },
        tag: 'tag_style',
        show: (sel) => sel.color !== 'rose', // Ros√© = skip (tous frais)
        options: (sel) => {
          if (sel.color === 'blanc') {
            return [
              { value: 'frais', label: 'Frais & Min√©ral', desc: 'Sauvignon, Muscadet, salinit√©' },
              { value: 'rond', label: 'Rond & Aromatique', desc: 'Chardonnay, fruits blancs' },
              { value: 'orange', label: 'Orange / Mac√©ration', desc: 'Vins atypiques, nature' }
            ];
          }
          if (sel.color === 'rouge') {
            return [
              { value: 'souple', label: 'Souple & Fruit√©', desc: 'Gamay, Pinot, croquant' },
              { value: 'puissant', label: 'Puissant & Structur√©', desc: 'Syrah, tanins, garrigue' },
              { value: 'nature', label: 'Nature / Bio', desc: 'Biodynamie, terroir vivant' }
            ];
          }
          return [];
        }
      },
      // Q4: Accord (optionnel, uniquement si "plat")
      {
        id: 'accord',
        question: 'Quel type de plat ?',
        tag: 'tag_accord',
        show: (sel) => sel.moment === 'plat',
        options: [
          { value: 'poisson', label: 'Poisson / Fruits de mer' },
          { value: 'viande_blanche', label: 'Viande blanche / Volaille' },
          { value: 'viande_rouge', label: 'Viande rouge / Gibier' },
          { value: 'fromage', label: 'Fromage / V√©g√©tarien' }
        ]
      }
    ];

    // SYST√àME DYNAMIQUE - Scoring bas√© sur les tags de la base de donn√©es
    const getWinesByPath = (selections) => {
      const { color, moment, style, accord } = selections;

      // Filtrer les vins actifs et scorer selon les tags
      let scored = wineData.map(wine => {
        let score = 0;

        // Match tag_couleur (poids: 10) - obligatoire
        if (color && normalize(wine.tag_couleur || '') === normalize(color)) {
          score += 10;
        }

        // Match tag_moment (poids: 8) - obligatoire
        if (moment && normalize(wine.tag_moment || '') === normalize(moment)) {
          score += 8;
        }

        // Match tag_style (poids: 6) - conditionnel
        if (style && normalize(wine.tag_style || '') === normalize(style)) {
          score += 6;
        }

        // Match tag_accord (poids: 5) - optionnel
        if (accord && normalize(wine.tag_accord || '') === normalize(accord)) {
          score += 5;
        }

        return { wine, score };
      });

      // Filtrer uniquement les vins avec score > 0 et trier par score d√©croissant
      scored = scored.filter(w => w.score > 0).sort((a, b) => b.score - a.score);

      // Si pas assez de r√©sultats, retourner des vins de la bonne couleur
      if (scored.length < 3) {
        const fallback = wineData.filter(w =>
          color && normalize(w.tag_couleur || '') === normalize(color)
        ).slice(0, 6);
        return fallback;
      }

      // Retourner les 6 meilleurs vins
      return scored.slice(0, 6).map(w => w.wine);
    };

    // Filtrer les questions selon les s√©lections actuelles
    const getWineQuestions = () => {
      return wineQuestions.filter(q => !q.show || q.show(wineTreeSelections));
    };

    const renderWineTree = () => {
      const panel = qs('#panel-vins');
      if (!panel) return;

      if (showingWineList) {
        renderWineList();
        return;
      }

      const questions = getWineQuestions();
      
      if (wineTreeStep >= questions.length) {
        renderWineRecommendations();
        return;
      }

      const currentQ = questions[wineTreeStep];
      const options = typeof currentQ.options === 'function' ? currentQ.options(wineTreeSelections) : currentQ.options;
      const questionText = typeof currentQ.question === 'function' ? currentQ.question(wineTreeSelections) : currentQ.question;

      let html = `
        <div class="wine-tree">
          <div class="wine-tree-header">
            <svg class="wine-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M7 3h10l-1 6a6 6 0 1 1-8 0z"/><path d="M12 15v6"/>
            </svg>
            <h2 class="wine-tree-title">Guide de s√©lection des vins</h2>
          </div>

          <div class="progress-bar">
            ${questions.map((_, idx) => `<div class="progress-step ${idx <= wineTreeStep ? 'active' : ''}"></div>`).join('')}
          </div>

          <div class="progress-info">√âtape ${wineTreeStep + 1} sur ${questions.length}</div>

          <h3 class="question-title">${questionText}</h3>
          
          <div class="wine-options">
            ${options.map(opt => `
              <button class="wine-option" data-value="${opt.value}">
                <div class="wine-option-content">
                  <div class="wine-option-label">
                    ${opt.icon ? `<span class="wine-option-icon">${opt.icon}</span>` : ''}
                    ${opt.label}
                  </div>
                  ${opt.desc ? `<div class="wine-option-desc">${opt.desc}</div>` : ''}
                </div>
                <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </button>
            `).join('')}
          </div>
          
          <div class="wine-nav-btns">
            ${wineTreeStep > 0 ? `
              <button class="wine-btn wine-btn-back" id="wineBackBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M15 18l-6-6 6-6"/>
                </svg>
                Retour
              </button>
            ` : ''}
            <button class="wine-btn wine-btn-secondary" id="showAllWinesFromTreeBtn">
              üìã Voir tous les vins
            </button>
          </div>
        </div>
      `;

      panel.innerHTML = html;

      qsa('.wine-option').forEach(btn => {
        btn.addEventListener('click', () => {
          wineTreeSelections[currentQ.id] = btn.dataset.value;
          wineTreeStep++;
          renderWineTree();
        });
      });

      const backBtn = qs('#wineBackBtn');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          const prevQ = questions[wineTreeStep - 1];
          delete wineTreeSelections[prevQ.id];
          wineTreeStep--;
          renderWineTree();
        });
      }
      
      const showAllBtn = qs('#showAllWinesFromTreeBtn');
      if (showAllBtn) {
        showAllBtn.addEventListener('click', () => {
          showingWineList = true;
          renderWineList();
        });
      }
    };

    const renderWineRecommendations = () => {
      const panel = qs('#panel-vins');
      if (!panel) return;

      const recommendations = getWinesByPath(wineTreeSelections);

      let html = `
        <div class="wine-recommendations">
          <div class="reco-header">
            <svg class="wine-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l2 5 5 2-5 2-2 5-2-5-5-2 5-2z"/>
            </svg>
            <h2 class="reco-title">Nos recommandations</h2>
          </div>

          ${recommendations.map(wine => `
            <div class="wine-card">
              <div class="wine-card-header">
                <div class="wine-card-name">${wine.Nom}</div>
                <div class="wine-card-price">${formatPrice(wine.Prix)}</div>
              </div>
              ${wine.Description ? `<div class="wine-card-region">${wine.Description.split(',')[0]}</div>` : ''}
              ${wine.Description && wine.Description.includes(',') ? `<div class="wine-card-grapes">${wine.Description.split(',').slice(1).join(',').trim()}</div>` : ''}
            </div>
          `).join('')}

          <div class="wine-nav-btns">
            <button class="wine-btn wine-btn-back" id="wineResetBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
              </svg>
              Nouvelle recherche
            </button>
            <button class="wine-btn wine-btn-secondary" id="showAllWinesBtn">
              üìã Voir tous les vins
            </button>
          </div>
        </div>
      `;

      panel.innerHTML = html;

      qs('#wineResetBtn').addEventListener('click', () => {
        wineTreeStep = 0;
        wineTreeSelections = {};
        showingWineList = false;
        renderWineTree();
      });

      qs('#showAllWinesBtn').addEventListener('click', () => {
        showingWineList = true;
        renderWineList();
      });
    };

    const renderWineList = () => {
      const panel = qs('#panel-vins');
      if (!panel) return;

      const groups = new Map();
      for (const wine of wineData) {
        const section = wine.Section || 'Autres';
        if (!groups.has(section)) groups.set(section, []);
        groups.get(section).push(wine);
      }

      let html = '<div style="padding: 1rem;">';
      
      for (const [section, wines] of groups) {
        html += `<h2 class="section-title">${section}</h2>`;
        wines.sort(byNameFR).forEach(wine => {
          html += `
            <div class="menu-item">
              <div class="item-info">
                <div class="item-name">${wine.Nom}</div>
                ${wine.Description ? `<div class="item-description">${wine.Description}</div>` : ''}
              </div>
              <div class="item-price">${formatPrice(wine.Prix)}</div>
            </div>
          `;
        });
      }

      html += `
        <div class="wine-nav-btns" style="margin-top: 2rem;">
          <button class="wine-btn wine-btn-primary" id="backToTreeBtn">
            üç∑ Retour au guide de s√©lection
          </button>
        </div>
      </div>`;

      panel.innerHTML = html;

      qs('#backToTreeBtn').addEventListener('click', () => {
        showingWineList = false;
        wineTreeStep = 0;
        wineTreeSelections = {};
        renderWineTree();
      });
    };

    const panels = {
      now: qs('#panel-now'), deguster: qs('#panel-deguster'), cocktails: qs('#panel-cocktails'),
      chaudes: qs('#panel-chaudes'), bieres: qs('#panel-bieres'), softs: qs('#panel-softs'), vins: qs('#panel-vins')
    };

    const showSkeleton = (el) => {
      el.innerHTML = `
        <div class="now-title">Chargement‚Ä¶</div>
        <div class="menu-item"><span class="skeleton big" style="width:60%"></span><span class="skeleton" style="width:90px"></span></div>
        <div class="menu-item"><span class="skeleton big" style="width:40%"></span><span class="skeleton" style="width:90px"></span></div>`;
    };

    const createItemHTML = (item) => {
      const section = item.Section ? `<div class="item-section">${item.Section}</div>` : '';
      const desc = item.Description ? `<div class="item-description">${item.Description}</div>` : '';
      return `
        <div class="menu-item">
          <div class="item-info">
            <div class="item-name">${item.Nom || ''}</div>
            ${section}${desc}
          </div>
          <div class="item-price">${formatPrice(item.Prix || '')}</div>
        </div>`;
    };

    const renderNow = () => {
      const el = panels.now; if (!el) return;
      let html = `<div class="now-title">√Ä l'affiche en ce moment</div>`;
      const nowItems = allMenuData.filter(i => normalize(i['En ce moment']) === 'oui');
      if (!nowItems.length){
        el.innerHTML = `<div class="empty-state"><h3>Aucune nouveaut√©</h3></div>`;
        return;
      }
      const groups = new Map();
      for (const it of nowItems){
        const key = it.Section || 'Autres';
        if (!groups.has(key)) groups.set(key, []);
        groups.get(key).push(it);
      }
      for (const [section, items] of groups){
        html += `<h2 class="section-title">${section}</h2>`;
        items.sort(byNameFR).forEach(it => { html += createItemHTML(it); });
      }
      el.innerHTML = html;
    };

    const renderTab = (tabName) => {
      if (tabName === 'now') return renderNow();
      if (tabName === 'vins') return renderWineTree();
      
      const el = panels[tabName]; if (!el) return;
      const tabItems = allMenuData.filter(i => tabIdFromOnglet(i.Onglet) === tabName);
      if (!tabItems.length){
        el.innerHTML = `<div class="empty-state"><h3>Section vide</h3></div>`;
        return;
      }
      const groups = new Map();
      for (const it of tabItems){
        const key = it.Section || 'Autres';
        if (!groups.has(key)) groups.set(key, []);
        groups.get(key).push(it);
      }
      let html = '';
      for (const [section, items] of groups){
        html += `<h2 class="section-title">${section}</h2>`;
        items.sort(byNameFR).forEach(it => { html += createItemHTML(it); });
      }
      el.innerHTML = html;
    };

    const renderAll = () => {
      for (const key of Object.keys(panels)) renderTab(key);
    };

    const setActiveTab = (tabName) => {
      currentTab = tabName;
      qsa('.tab-btn').forEach(btn => {
        const active = btn.dataset.tab === tabName;
        btn.setAttribute('aria-selected', active ? 'true' : 'false');
        btn.tabIndex = active ? 0 : -1;
      });
      qsa('.tab-content').forEach(p => p.classList.remove('active'));
      qs(`#panel-${tabName}`)?.classList.add('active');
      if (!isSearching) renderTab(tabName);
    };

    const focusNextTab = (dir) => {
      const tabs = qsa('.tab-btn');
      const idx = tabs.findIndex(t => t.getAttribute('aria-selected') === 'true');
      const next = (idx + dir + tabs.length) % tabs.length;
      tabs[next].focus();
      setActiveTab(tabs[next].dataset.tab);
    };

    function ensurePapa(){
      return new Promise((resolve, reject) => {
        if (window.Papa?.parse) return resolve();
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js';
        s.onload = () => window.Papa?.parse ? resolve() : reject();
        s.onerror = reject;
        document.head.appendChild(s);
        setTimeout(() => { if (!window.Papa?.parse) reject(); }, 5000);
      });
    }

    const parseAndSet = (rows=[]) => {
      const sanitize = (r) => { const o={}; for (const k in r){ const nk=(k||'').trim(); let v=r[k]; if (typeof v==='string') v=v.trim(); o[nk]=v; } return o; };
      const cleaned = rows.map(sanitize);
      allMenuData = cleaned.filter(i => normalize(i.Actif) === 'oui' || normalize(i['Actif '])==='oui');
      wineData = allMenuData.filter(i => normalize(i.Onglet).includes('vin'));
      renderAll();
      startPlaceholderRotation();
      hideSplashScreen();
    };

    const loadFromCacheIfFresh = () => {
      try{
        const at = Number(localStorage.getItem(CACHE_AT)||0);
        if (Date.now() - at < CACHE_TTL){
          const cached = JSON.parse(localStorage.getItem(CACHE_KEY)||'[]');
          if (Array.isArray(cached) && cached.length){ parseAndSet(cached); return true; }
        }
      }catch{}
      return false;
    };

    const saveCache = (rows) => {
      try{
        localStorage.setItem(CACHE_KEY, JSON.stringify(rows));
        localStorage.setItem(CACHE_AT, String(Date.now()));
      }catch{}
    };

    const showError = () => { qs('#errorContainer').style.display = 'block'; };
    const hideError = () => { qs('#errorContainer').style.display = 'none'; };

    const fetchCSVAndRender = async () => {
      Object.values(panels).forEach(p => p && showSkeleton(p));
      if (loadFromCacheIfFresh()) return;

      let attempt = 0;
      while (attempt < 3){
        try{
          await new Promise((resolve, reject) => {
            Papa.parse(CSV_URL, {
              download: true,
              header: true,
              complete: (res) => {
                if (res.errors?.length){ reject(res.errors); return; }
                hideError();
                saveCache(res.data);
                parseAndSet(res.data);
                resolve();
              },
              error: reject
            });
          });
          return;
        }catch(e){
          attempt++;
          if (attempt >= 3){ showError(); break; }
          await new Promise(r => setTimeout(r, 400 * Math.pow(2, attempt)));
        }
      }
    };

    const performSearch = (query) => {
      isSearching = true;
      lastQuery = query;
      const q = normalize(query);
      const results = allMenuData.filter(i =>
        normalize(i.Nom).includes(q) || normalize(i.Description).includes(q) || normalize(i.Section).includes(q)
      );
      lastSearchResults = results;
      const info = qs('#searchInfo');
      info.style.display = 'block';
      info.textContent = `${results.length} r√©sultat(s) pour "${query}"`;

      // Afficher les r√©sultats dans le panneau actif
      renderSearchResults(results);
    };

    const renderSearchResults = (results) => {
      const activePanel = qs('.tab-content.active');
      if (!activePanel) return;

      if (!results.length) {
        activePanel.innerHTML = `<div class="empty-state"><h3>Aucun r√©sultat</h3><p>Essayez avec un autre terme de recherche</p></div>`;
        return;
      }

      // Grouper les r√©sultats par section
      const groups = new Map();
      for (const item of results) {
        const key = item.Section || 'Autres';
        if (!groups.has(key)) groups.set(key, []);
        groups.get(key).push(item);
      }

      let html = '';
      for (const [section, items] of groups) {
        html += `<h2 class="section-title">${section}</h2>`;
        items.sort(byNameFR).forEach(item => { html += createItemHTML(item); });
      }
      activePanel.innerHTML = html;
    };

    const clearSearch = () => {
      isSearching = false;
      qs('#searchBox').value = '';
      qs('#searchInfo').style.display = 'none';
      renderTab(currentTab);
    };

    const init = () => {
      qsa('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          setActiveTab(btn.dataset.tab);
        });
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowRight') { e.preventDefault(); focusNextTab(+1); }
          if (e.key === 'ArrowLeft')  { e.preventDefault(); focusNextTab(-1); }
        });
      });

      const searchBox = qs('#searchBox');
      const clearBtn = qs('#clearSearch');

      // Bouton croix visible uniquement au focus/contenu
      searchBox.addEventListener('focus', () => {
        clearBtn.classList.add('visible');
      });

      searchBox.addEventListener('blur', () => {
        setTimeout(() => {
          if (!searchBox.value.trim()) {
            clearBtn.classList.remove('visible');
          }
        }, 200);
      });

      searchBox.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();

        if (query) {
          clearBtn.classList.add('visible');
        }

        if (!query){
          clearSearch();
          clearBtn.classList.remove('visible');
          return;
        }
        searchTimeout = setTimeout(() => performSearch(query), 250);
      });

      clearBtn.addEventListener('click', () => {
        clearSearch();
        clearBtn.classList.remove('visible');
        searchBox.blur();
      });
      qs('#retryBtn').addEventListener('click', () => ensurePapa().then(fetchCSVAndRender).catch(showError));

      const share = qs('#btnShare');
      if (share){
        share.addEventListener('click', async () => {
          const url = location.href;
          if (navigator.share){ try{ await navigator.share({title:document.title,url}); }catch(e){} }
          else { try{ await navigator.clipboard.writeText(url); }catch(e){} }
        });
      }

      ensurePapa().then(fetchCSVAndRender).catch(showError);
    };

    // Placeholder dynamique - UN SEUL produit, rotation 5s
    const updatePlaceholder = () => {
      const searchBox = qs('#searchBox');
      if (!searchBox || !allMenuData.length) return;

      const nowItems = allMenuData.filter(i => normalize(i['En ce moment']) === 'oui');
      if (nowItems.length > 0) {
        // UN SEUL produit al√©atoire
        const randomIndex = Math.floor(Math.random() * nowItems.length);
        const randomProduct = nowItems[randomIndex].Nom;
        searchBox.placeholder = `Rechercher‚Ä¶ (ex: ${randomProduct})`;
      }
    };

    const startPlaceholderRotation = () => {
      updatePlaceholder();
      placeholderInterval = setInterval(updatePlaceholder, 5000); // 5 secondes
    };

    // Gestion du Splash Screen
    let splashTimeout;
    const hideSplashScreen = () => {
      const splash = qs('#splashScreen');
      if (!splash) return;

      // Attendre au minimum 2 secondes pour l'effet premium
      const minDisplayTime = 2000;
      const elapsed = Date.now() - (window.splashStartTime || 0);
      const remainingTime = Math.max(0, minDisplayTime - elapsed);

      setTimeout(() => {
        splash.classList.add('fade-out');
        setTimeout(() => {
          splash.style.display = 'none';
        }, 500);
      }, remainingTime);
    };

    // Enregistrer l'heure de d√©but au chargement de la page
    window.splashStartTime = Date.now();

    // Fallback : cacher le splash apr√®s 5 secondes maximum
    window.addEventListener('load', () => {
      splashTimeout = setTimeout(hideSplashScreen, 5000);
    });

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>

