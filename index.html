<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu ‚Äî Maison Fleurie</title>
  <meta name="description" content="D√©couvrez le menu de Maison Fleurie ‚Äî Table des Mets, Cocktails & Vins √† Montpellier." />
  <meta name="theme-color" content="#0D1F13" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="fr_FR" />
  <meta property="og:title" content="Menu ‚Äî Maison Fleurie" />
  <meta property="og:description" content="Table des Mets ‚Ä¢ Cocktails ‚Ä¢ Vins √† Montpellier" />
  <meta property="og:image" content="https://raw.githubusercontent.com/maison-fleurie/Menu/main/logo.png" />
  <meta property="og:url" content="" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Fonts & perf -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Viaoda+Libre:wght@400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- PapaParse (SRI + defer) -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      --vert-fond:#0D1F13;--beige-logo:#ABA977;--blanc:#FFFFFF;--beige-clair:#F8F6F0;--vert-accent:#2A4A32;--or-accent:#D4C48A;--gris-texte:#4A5C4E;--ombre-douce:rgba(13,31,19,.1);--ombre-forte:rgba(13,31,19,.25);--gradient-warm:linear-gradient(135deg,#ABA977 0%,#D4C48A 50%,#E8D5A3 100%);--gradient-cool:linear-gradient(135deg,#0D1F13 0%,#2A4A32 50%,#4A6A4A 100%);--shadow-modern:0 8px 32px rgba(13,31,19,.12);--shadow-elevated:0 16px 64px rgba(13,31,19,.2);--radius-lg:24px;--radius-md:16px
    }

    *{box-sizing:border-box}
    html:focus-within{scroll-behavior:smooth}
    body{margin:0;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--gradient-warm);color:var(--vert-fond);min-height:100vh;line-height:1.6}

    /* Motion-safe */
    @media (prefers-reduced-motion:no-preference){
      body{animation:backgroundBreath 8s ease-in-out infinite}
      @keyframes backgroundBreath{0%,100%{background:var(--gradient-warm)}50%{background:linear-gradient(135deg,#D4C48A 0%,#ABA977 50%,#E8D5A3 100%)}}
    }

    a,button{outline-offset:3px}

    /* Header */
    header.header{position:relative;text-align:center;background:var(--gradient-cool);color:var(--beige-logo);padding:3rem 1rem 2rem;box-shadow:var(--shadow-elevated);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.1)}

    @media (prefers-reduced-motion:no-preference){
      .header-title{animation:titleGlow 4s ease-in-out infinite alternate}
      @keyframes titleGlow{0%{text-shadow:0 4px 8px rgba(0,0,0,.3)}100%{text-shadow:0 4px 8px rgba(0,0,0,.3),0 0 20px rgba(171,169,119,.4)}}
    }

    .header-title{font-family:'Viaoda Libre',serif;display:flex;align-items:center;justify-content:center;gap:2rem;margin:0;font-size:2.8rem;font-weight:400;letter-spacing:4px;line-height:1.2}
    .header-logo{height:3.5rem;width:3.5rem;object-fit:contain;filter:drop-shadow(0 6px 12px rgba(0,0,0,.4))}
    .header-subtitle{margin:1rem 0 0;font-size:1.2rem;font-weight:300;letter-spacing:1.5px;color:var(--or-accent)}

    /* Language toggle */
    .lang-toggle{position:absolute;left:16px;top:16px;display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.25);border-radius:20px;padding:4px;backdrop-filter:blur(6px)}
    .lang-btn{background:transparent;border:none;color:var(--beige-logo);padding:8px 12px;border-radius:16px;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s}
    .lang-btn.active{background:rgba(255,255,255,.2);color:white}
    .lang-btn:hover:not(.active){background:rgba(255,255,255,.1)}

    /* Share icon */
    .share-btn{position:absolute;right:16px;top:16px;display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.08);color:var(--beige-logo);cursor:pointer;backdrop-filter:blur(6px)}
    .share-btn:hover{background:rgba(255,255,255,.15)}

    /* Search */
    .search-container{margin:1.5rem auto 1rem;max-width:700px;padding:0 1rem}
    .search-row{display:flex;gap:.5rem}
    .search-box{flex:1;padding:1.1rem 1.2rem;font-size:1rem;border-radius:var(--radius-lg);border:2px solid transparent;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);box-shadow:var(--shadow-modern);color:var(--vert-fond)}
    .search-box:focus{border-color:var(--vert-fond);box-shadow:var(--shadow-elevated),0 0 0 4px rgba(13,31,19,.1);background:#fff}
    .clear-btn{border:2px solid var(--beige-logo);background:#fff;border-radius:var(--radius-lg);padding:.9rem 1rem;cursor:pointer}
    .search-results-info{font-size:1rem;color:var(--vert-fond);margin:1rem 0;font-weight:500;text-align:center;padding:.8rem 1.5rem;background:rgba(255,255,255,.9);border-radius:var(--radius-md);backdrop-filter:blur(15px);box-shadow:var(--shadow-modern)}

    /* Main container */
    main.container{max-width:900px;margin:1rem auto 3rem;background:rgba(255,255,255,.98);border-radius:var(--radius-lg);box-shadow:var(--shadow-elevated);overflow:hidden;border:1px solid rgba(13,31,19,.1);backdrop-filter:blur(20px)}

    /* Icon styles */
    .tab-btn{display:inline-flex;align-items:center;gap:.5rem}
    .tab-btn .ico{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px}
    .tab-btn .ico svg{width:18px;height:18px;display:block}

    /* Tabs */
    nav.tab-nav{display:flex;flex-wrap:wrap;justify-content:center;background:linear-gradient(135deg,var(--beige-clair) 0%,rgba(255,255,255,.95) 100%);border-bottom:2px solid var(--vert-fond);gap:.6rem;padding:1rem;position:sticky;top:0;z-index:10;backdrop-filter:blur(15px)}
    .tab-btn{background:#fff;border:2px solid var(--beige-logo);padding:.9rem 1.2rem;font-size:1rem;cursor:pointer;font-weight:500;color:var(--vert-fond);border-radius:var(--radius-lg);position:relative;box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .tab-btn[aria-selected="true"]{background:var(--gradient-cool);color:var(--beige-logo);border-color:var(--or-accent);box-shadow:0 8px 24px rgba(13,31,19,.2)}

    .tab-content{display:none;padding:2rem 1.5rem;background:#fff;min-height:420px}
    .tab-content.active{display:block}

    /* Items */
    .menu-item{display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;padding:1.1rem 1rem;border-bottom:1px solid rgba(13,31,19,.06);background:linear-gradient(135deg,rgba(248,246,240,.4) 0%,rgba(255,255,255,.8) 100%);border-radius:var(--radius-md)}
    .menu-item + .menu-item{margin-top:.7rem}
    .item-info{flex:1;min-width:0}
    .item-name{font-size:1.15rem;font-weight:600;color:var(--vert-fond);letter-spacing:.3px;line-height:1.3}
    .item-section{font-size:.8rem;color:var(--gris-texte);margin:.3rem 0 .5rem;font-weight:600;text-transform:uppercase;letter-spacing:1.2px;opacity:.85}
    .item-description{font-size:.98rem;color:var(--gris-texte);font-style:italic;margin-top:.2rem}
    .item-price{font-size:1.05rem;color:var(--vert-fond);font-weight:700;background:var(--gradient-warm);border-radius:12px;padding:.5rem .75rem;min-width:84px;text-align:center}

    .section-title{font-family:'Viaoda Libre',serif;font-size:1.6rem;color:var(--vert-fond);margin:1.8rem 0 1rem;text-align:center;letter-spacing:1.5px;position:relative}
    .section-title::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:80px;height:4px;background:var(--gradient-warm);border-radius:2px}
    .now-title{font-size:1.3rem;font-family:'Viaoda Libre',serif;color:var(--vert-accent);margin:1rem 0 1rem;text-align:center}

    /* Empty & skeleton */
    .empty-state{text-align:center;color:var(--gris-texte);margin:2.2rem 0;padding:2rem 1.4rem;background:linear-gradient(135deg,rgba(248,246,240,.3) 0%,rgba(255,255,255,.5) 100%);border-radius:var(--radius-lg);border:1px solid rgba(13,31,19,.06)}
    .skeleton{display:block;height:16px;background:linear-gradient(90deg,#eee,#f7f7f7,#eee);border-radius:8px;animation:sheen 1.6s infinite}
    .skeleton.big{height:22px}
    @keyframes sheen{0%{background-position:-200px 0}100%{background-position:calc(200px + 100%) 0}}

    /* Responsive */
    @media (max-width:768px){
      .header-title{font-size:2.2rem;gap:1.2rem}
      .header-logo{height:3rem;width:3rem}
      .menu-item{flex-direction:column}
      .item-price{align-self:flex-end}
      .lang-toggle{position:static;margin-bottom:1rem}
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header" role="banner">
    <!-- Language Toggle -->
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="fr">FR</button>
      <button class="lang-btn" data-lang="en">EN</button>
    </div>

    <h1 class="header-title"><span>MAISON</span>
      <img src="https://raw.githubusercontent.com/maison-fleurie/Menu/main/logo.png" alt="Logo Maison Fleurie" class="header-logo" />
      <span>FLEURIE</span></h1>
    
    <button id="btnShare" class="share-btn" aria-label="Partager" title="Partager" tabindex="0" aria-controls="main">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.02-4.11A2.99 2.99 0 0 0 18 7.91c1.66 0 3-1.34 3-3S19.66 2 18 2s-3 1.34-3 3c0 .24.04.47.09.7l-7.02 4.11A2.99 2.99 0 0 0 6 9.91c-1.66 0-3 1.34-3 3s1.34 3 3 3c.82 0 1.56-.33 2.09-.87l7.02 4.11c-.05.21-.08.43-.08.66 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3Z"/></svg>
    </button>
    <p class="header-subtitle" data-text="subtitle">Table des Mets ‚Ä¢ Cocktails ‚Ä¢ Vins</p>
  </header>

  <noscript>
    <style>.nojs{max-width:900px;margin:1rem auto;background:#fff;border:1px solid #c00;color:#111;padding:1rem;border-radius:12px}</style>
    <div class="nojs">
      ‚ö†Ô∏è JavaScript est d√©sactiv√©. Activez‚Äële pour voir le menu interactif.
    </div>
  </noscript>

  <!-- Search -->
  <div class="search-container">
    <div class="search-row">
      <input id="searchBox" class="search-box" type="search" inputmode="search" placeholder="Rechercher‚Ä¶ (ex: Vin, Bi√®re, Karaage poulet)" autocomplete="off" />
      <button id="clearSearch" class="clear-btn" aria-label="Effacer la recherche">‚úñ</button>
    </div>
    <div id="searchInfo" class="search-results-info" aria-live="polite" style="display:none"></div>
  </div>

  <!-- Main -->
  <main id="main" class="container" role="main">
    <!-- Tabs -->
    <nav class="tab-nav" role="tablist" aria-label="Cat√©gories du menu">
      <button id="tab-now" class="tab-btn" role="tab" aria-selected="true" aria-controls="panel-now" data-tab="now"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l2 5 5 2-5 2-2 5-2-5-5-2 5-2z"/></svg></span><span data-text="tab-now">En ce moment</span></button>
      <button id="tab-deguster" class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-deguster" data-tab="deguster"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 3v10M11 3v10M5 7h8M16 4h3v9a3 3 0 0 1-3 3h-3"/></svg></span><span data-text="tab-deguster">D√©guster</span></button>
      <button id="tab-cocktails" class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-cocktails" data-tab="cocktails"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M3 4h18l-7 7v7h-4v-7z"/><path d="M8 4l4 4 4-4"/></svg></span><span data-text="tab-cocktails">Cocktails</span></button>
      <button id="tab-chaudes" class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-chaudes" data-tab="chaudes"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8h12a4 4 0 0 1 0 8H4z"/><path d="M16 10h1a3 3 0 0 1 0 6h-1"/><path d="M7 4c0 2 2 2 2 4s-2 2-2 4"/></svg></span><span data-text="tab-chaudes">Chaudes</span></button>
      <button id="tab-bieres" class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-bieres" data-tab="bieres"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 8h8v12H7z"/><path d="M15 10h2a3 3 0 0 1 0 6h-2"/><path d="M7 8V7a3 3 0 0 1 3-3h3a3 3 0 0 1 3 3v1"/></svg></span><span data-text="tab-bieres">Bi√®res</span></button>
      <button id="tab-softs" class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-softs" data-tab="softs"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7h10l-2 13H9z"/><path d="M10 4l6 3"/><path d="M9 11h8"/></svg></span><span data-text="tab-softs">Softs</span></button>
      <button id="tab-vins" class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-vins" data-tab="vins"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 3h10l-1 6a6 6 0 1 1-8 0z"/><path d="M12 15v6"/></svg></span><span data-text="tab-vins">Vins</span></button>
    </nav>

    <!-- Panels -->
    <section id="panel-now" class="tab-content active" role="tabpanel" tabindex="0" aria-labelledby="tab-now"></section>
    <section id="panel-deguster" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tab-deguster"></section>
    <section id="panel-cocktails" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tab-cocktails"></section>
    <section id="panel-chaudes" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tab-chaudes"></section>
    <section id="panel-bieres" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tab-bieres"></section>
    <section id="panel-softs" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tab-softs"></section>
    <section id="panel-vins" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tab-vins"></section>

    <!-- Error -->
    <div id="errorContainer" class="empty-state" style="display:none">
      <h3 data-text="error-title">Oups ! Impossible de charger le menu</h3>
      <p data-text="error-message">V√©rifiez votre connexion et r√©essayez.</p>
      <button id="retryBtn" data-text="retry-btn">üîÑ R√©essayer</button>
    </div>
  </main>

  <script>
    // ====== Translation dictionaries ======
    const TRANSLATIONS = {
      fr: {
        'subtitle': 'Table des Mets ‚Ä¢ Cocktails ‚Ä¢ Vins',
        'tab-now': 'En ce moment',
        'tab-deguster': 'D√©guster', 
        'tab-cocktails': 'Cocktails',
        'tab-chaudes': 'Chaudes',
        'tab-bieres': 'Bi√®res',
        'tab-softs': 'Softs',
        'tab-vins': 'Vins',
        'now-title': '√Ä l\'affiche en ce moment',
        'error-title': 'Oups ! Impossible de charger le menu',
        'error-message': 'V√©rifiez votre connexion et r√©essayez.',
        'retry-btn': 'üîÑ R√©essayer',
        'search-placeholder': 'Rechercher‚Ä¶ (ex: Vin, Bi√®re, Karaage poulet)',
        'search-results': 'r√©sultat(s) pour',
        'no-results-title': 'Aucun r√©sultat',
        'no-results-message': 'Aucun plat ou boisson ne correspond √†',
        'no-news-title': 'Aucune nouveaut√©',
        'no-news-message': 'Aucun plat ou boisson n\'est mis en avant pour l\'instant.',
        'empty-section-title': 'Section vide',
        'empty-section-message': 'Aucun √©l√©ment dans cette cat√©gorie pour le moment.',
        'loading': 'Chargement‚Ä¶'
      },
      en: {
        'subtitle': 'Fine Dining ‚Ä¢ Cocktails ‚Ä¢ Wines',
        'tab-now': 'Featured',
        'tab-deguster': 'Food',
        'tab-cocktails': 'Cocktails', 
        'tab-chaudes': 'Hot Drinks',
        'tab-bieres': 'Beers',
        'tab-softs': 'Soft Drinks',
        'tab-vins': 'Wines',
        'now-title': 'Currently featured',
        'error-title': 'Oops! Unable to load the menu',
        'error-message': 'Check your connection and try again.',
        'retry-btn': 'üîÑ Retry',
        'search-placeholder': 'Search‚Ä¶ (e.g.: Wine, Beer, Chicken Karaage)',
        'search-results': 'result(s) for',
        'no-results-title': 'No results',
        'no-results-message': 'No dish or drink matches',
        'no-news-title': 'No news',
        'no-news-message': 'No dish or drink is currently featured.',
        'empty-section-title': 'Empty section',
        'empty-section-message': 'No items in this category at the moment.',
        'loading': 'Loading‚Ä¶'
      }
    };

    // Simple translation dictionary for menu items
    const MENU_TRANSLATIONS = {
      // Sections/Categories
      'Ap√©ritif': 'Appetizer',
      'Entr√©es': 'Starters', 
      'Plats': 'Main Courses',
      'Desserts': 'Desserts',
      'Boissons chaudes': 'Hot Beverages',
      'Vins rouges': 'Red Wines',
      'Vins blancs': 'White Wines',
      'Vins ros√©s': 'Ros√© Wines',
      'Champagnes': 'Champagnes',
      'Bi√®res': 'Beers',
      'Cocktails': 'Cocktails',
      'Softs': 'Soft Drinks',
      'Spiritueux': 'Spirits',

      // Common food items
      'Karaage poulet': 'Chicken Karaage',
      'Salade': 'Salad',
      'Burger': 'Burger', 
      'Frites': 'French Fries',
      'Tartare': 'Tartare',
      'Saumon': 'Salmon',
      'B≈ìuf': 'Beef',
      'Porc': 'Pork',
      'Agneau': 'Lamb',
      'Poisson': 'Fish',
      'L√©gumes': 'Vegetables',
      'Fromage': 'Cheese',
      'Chocolat': 'Chocolate',
      'Fruits': 'Fruits',
      
      // Drinks
      'Caf√©': 'Coffee',
      'Th√©': 'Tea',
      'Chocolat chaud': 'Hot Chocolate',
      'Vin rouge': 'Red Wine',
      'Vin blanc': 'White Wine', 
      'Vin ros√©': 'Ros√© Wine',
      'Bi√®re': 'Beer',
      'Eau': 'Water',
      'Jus': 'Juice',
      'Soda': 'Soda',

      // Common adjectives/descriptors  
      'grill√©': 'grilled',
      'r√¥ti': 'roasted',
      'frit': 'fried',
      'marin√©': 'marinated',
      'fum√©': 'smoked',
      'cru': 'raw',
      'maison': 'homemade',
      'frais': 'fresh',
      'bio': 'organic',
      'artisanal': 'artisanal',
      'traditionnel': 'traditional',
      'sp√©cialit√©': 'specialty'
    };

    // ====== Safety shim ======
    if (typeof window !== 'undefined' && typeof window.invoke === 'undefined') {
      window.invoke = function(){ console.warn('[shim] window.invoke() appel√© mais non d√©fini dans cette page ‚Äî no‚Äëop.'); };
    }

    // ====== Config ======
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/1lgd-rGS2kLCn0yPtGMc7RyMDue-YERmKOjNT3QKgJ3Y/export?format=csv&gid=0';
    const CACHE_KEY = 'maison-fleurie-menu-cache-v2';
    const CACHE_AT = 'maison-fleurie-menu-cache-at';
    const CACHE_TTL_MS = 15 * 60 * 1000; // 15 minutes

    // ====== State ======
    let allMenuData = [];
    let currentTab = 'now';
    let currentLang = 'fr';
    let isSearching = false;
    let searchTimeout;

    // ====== Utils ======
    const normalize = (s='') => s.toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();
    const tabIdFromOnglet = (s='') => normalize(s).replace(/\s/g,'');

    // ====== Translation functions ======
    const t = (key) => TRANSLATIONS[currentLang][key] || TRANSLATIONS.fr[key] || key;

    const translateText = (text) => {
      if (!text || currentLang === 'fr') return text;
      
      // Try direct translation first
      if (MENU_TRANSLATIONS[text]) return MENU_TRANSLATIONS[text];
      
      // Try to translate parts of the text
      let translated = text;
      for (const [fr, en] of Object.entries(MENU_TRANSLATIONS)) {
        const regex = new RegExp(`\\b${fr}\\b`, 'gi');
        translated = translated.replace(regex, en);
      }
      
      return translated;
    };

    const updateUITexts = () => {
      // Update all elements with data-text attribute
      document.querySelectorAll('[data-text]').forEach(el => {
        const key = el.getAttribute('data-text');
        el.textContent = t(key);
      });